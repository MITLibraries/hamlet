language: python
python:
- '3.6'
install:
- pip install pipenv
- pip install coveralls
- pipenv install
script: coverage run manage.py test
after_success: coveralls
addons:
  postgresql: '9.6'
services:
- postgresql
before_script:
- psql -c 'create database travis_ci_test;' -U postgres
env:
  global:
  - DJANGO_DB=travis_ci_test
  - DJANGO_DB_USER=postgres
  - DJANGO_SETTINGS_MODULE=hamlet.settings.test
before_deploy:
- rm -rf hamlet/testmodels/
- pipenv run pip freeze > requirements.txt
- git add requirements.txt
- git commit -am "requirements/testmodels cleanup"
deploy:
  provider: elasticbeanstalk
  access_key_id: $ACCESS_KEY
  secret_access_key: $SECRET_KEY
  region: us-east-2
  bucket_name: elasticbeanstalk-us-east-2-214921548711
  #bucket_path: hamlet
  app: hamlet
  env: Hamlet-env
  on:
    repo: thatandromeda/hamlet
    branch: master
  skip_cleanup: true
